# 工作流程名稱
name: Update roles.json and push to Hugging Face

# 觸發工作流程的事件
on:
  workflow_dispatch:
  repository_dispatch:
    types: [update-roles-json]

# 定義工作
jobs:
  download-and-update:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      # 1. 拉取儲存庫的最新程式碼
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. 從 Google Drive 下載最新的 roles.json 檔案
      - name: Download roles.json from Google Drive
        run: |
          curl -L -o roles.json 'https://drive.google.com/uc?export=download&id=19Qa3RRQXOJBKMPsvQB994ig0UJSpQkJP'

      # 3. 讓腳本檔案擁有執行權限
      - name: Make script executable
        run: chmod +x ./update_and_push.sh

      # 4. 執行提交與推送的腳本
      - name: Run commit and push script
        env:
          # 將 HF_TOKEN 作為環境變數傳遞給腳本
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: ./update_and_push.sh
